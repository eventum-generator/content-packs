# Microsoft Exchange Server Message Tracking Log Generator
#
# Produces realistic Exchange Server 2019 message tracking events (ECS-compatible
# JSON) matching the Elastic microsoft_exchange integration field structure.
# Events cover the full mail flow pipeline: receive, submit, send, deliver,
# shadow redundancy, categorization, and error handling.
#
# Usage:
#   eventum generate --path generators/email-exchange/generator.yml --id exch --live-mode

input:
  - cron:
      expression: "* * * * * *"
      count: 5

event:
  template:
    mode: chance

    # Environment parameters — edit for your setup
    params:
      hostname: EXCH01
      domain: contoso.com
      server_ip: "10.0.1.10"
      dag_name: DAG01
      ad_site: Default-First-Site-Name
      schema_version: "15.02.1544.009"
      agent_id: "a1b2c3d4-e5f6-7890-abcd-ef1234567890"
      agent_version: "8.17.0"
      ecs_version: "8.17.0"
      max_message_pool: 80

    # Sample data
    samples:
      internal_users:
        type: csv
        source: samples/internal_users.csv
        header: true
      external_domains:
        type: json
        source: samples/external_domains.json
      subjects:
        type: json
        source: samples/subjects.json
      connectors:
        type: json
        source: samples/connectors.json
      distribution_groups:
        type: json
        source: samples/distribution_groups.json

    # Event templates with realistic frequency distribution
    # Weights approximate a production Exchange Server deployment
    templates:
      # Core mail flow — ~70% of total volume
      - receive_inbound:
          template: templates/receive-inbound.json.jinja
          chance: 250
      - receive_internal:
          template: templates/receive-internal.json.jinja
          chance: 200
      - submit:
          template: templates/submit.json.jinja
          chance: 180
      - send:
          template: templates/send.json.jinja
          chance: 200
      - deliver:
          template: templates/deliver.json.jinja
          chance: 400

      # Shadow redundancy — ~8%
      - haredirect:
          template: templates/haredirect.json.jinja
          chance: 120
      - hadiscard:
          template: templates/hadiscard.json.jinja
          chance: 30

      # MAPI notifications — ~5%
      - notifymapi:
          template: templates/notifymapi.json.jinja
          chance: 80

      # Categorization — ~8%
      - agentinfo:
          template: templates/agentinfo.json.jinja
          chance: 100
      - resolve:
          template: templates/resolve.json.jinja
          chance: 40
      - expand:
          template: templates/expand.json.jinja
          chance: 30
      - transfer:
          template: templates/transfer.json.jinja
          chance: 15

      # Error and failure — ~3%
      - defer:
          template: templates/defer.json.jinja
          chance: 20
      - fail:
          template: templates/fail.json.jinja
          chance: 10
      - dsn:
          template: templates/dsn.json.jinja
          chance: 10
      - drop:
          template: templates/drop.json.jinja
          chance: 5

      # Rare events — ~1%
      - redirect:
          template: templates/redirect.json.jinja
          chance: 5

output:
  - file:
      path: output/events.json
      write_mode: overwrite
      formatter:
        format: json
