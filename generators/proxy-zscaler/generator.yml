# Zscaler Internet Access (ZIA) Web Proxy Event Generator
#
# Produces realistic ZIA web proxy/transaction events (ECS-compatible JSON)
# matching the Elastic zscaler_zia integration field structure. Events cover
# allowed traffic, URL policy blocks, security threat blocks, DLP cautions,
# bandwidth throttling, file type blocks, and browser isolation.
#
# Usage:
#   eventum generate --path generators/proxy-zscaler/generator.yml --id zscaler-zia --live-mode

input:
  - cron:
      expression: "* * * * * *"
      count: 5

event:
  template:
    mode: chance

    # Environment parameters â€” edit for your setup
    params:
      company: SafeMarch Inc
      cloudname: zscaler.net
      datacenter: US-CA1 Client Node DC
      datacenter_city: San Jose
      datacenter_country: US
      nss_server: nss-feed-01
      product_version: "6.2.1.110_04"
      agent_id: "a1b2c3d4-e5f6-7890-abcd-ef1234567890"
      agent_version: "8.17.0"
      timezone: UTC

    # Sample data
    samples:
      devices:
        type: csv
        source: samples/devices.csv
        header: true
      users:
        type: csv
        source: samples/users.csv
        header: true
      url_categories_allowed:
        type: json
        source: samples/url_categories_allowed.json
      url_categories_blocked_policy:
        type: json
        source: samples/url_categories_blocked_policy.json
      url_categories_blocked_security:
        type: json
        source: samples/url_categories_blocked_security.json
      cloud_apps:
        type: json
        source: samples/cloud_apps.json
      threats:
        type: json
        source: samples/threats.json

    # Event templates with realistic frequency distribution
    # Weights approximate a production enterprise with Zscaler ZIA
    templates:
      # ~80% allowed traffic (business apps, cloud, general browsing)
      - allowed_traffic:
          template: templates/allowed.json.jinja
          chance: 800

      # ~8% blocked by URL filtering policy (adult, gambling, anonymizers, etc.)
      - blocked_url_policy:
          template: templates/blocked-policy.json.jinja
          chance: 80

      # ~3% blocked by security (malware, phishing, C2, cryptomining)
      - blocked_security:
          template: templates/blocked-security.json.jinja
          chance: 30

      # ~1.5% cautioned by DLP (sensitive data upload detected)
      - cautioned_dlp:
          template: templates/cautioned-dlp.json.jinja
          chance: 15

      # ~5% allowed but bandwidth-throttled (streaming, large downloads)
      - throttled:
          template: templates/throttled.json.jinja
          chance: 50

      # ~2% blocked by file type control (executables from untrusted sites)
      - blocked_filetype:
          template: templates/blocked-filetype.json.jinja
          chance: 20

      # ~0.5% isolated via browser isolation (uncategorized/risky sites)
      - isolated:
          template: templates/isolated.json.jinja
          chance: 5

output:
  - file:
      path: output/events.json
      write_mode: overwrite
      formatter:
        format: json
