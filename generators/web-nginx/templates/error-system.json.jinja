{%- set hostname = params.hostname -%}
{%- set pid = params.get('nginx_pid', 1234) -%}
{#- Pick a system error -#}
{%- set err = samples.error_messages | selectattr("category", "eq", "system") | list | random -%}
{#- System errors have no connection ID (process-level, not connection-level) -#}
{%- set msg = err.message -%}
{%- if "${pid}" in msg -%}
  {%- set worker_pid = module.rand.number.integer(1235, 9999) -%}
  {%- set msg = msg | replace("${pid}", worker_pid | string) -%}
{%- endif -%}
{
    "@timestamp": "{{ timestamp.isoformat() }}",
    "agent": {
        "ephemeral_id": "{{ module.rand.crypto.uuid4() }}",
        "id": "{{ params.agent_id }}",
        "name": "{{ hostname }}",
        "type": "filebeat",
        "version": "{{ params.agent_version }}"
    },
    "data_stream": {
        "dataset": "nginx.error",
        "namespace": "default",
        "type": "logs"
    },
    "ecs": {
        "version": "8.11.0"
    },
    "event": {
        "category": ["web"],
        "dataset": "nginx.error",
        "kind": "event",
        "module": "nginx",
        "type": ["error"]
    },
    "host": {
        "hostname": "{{ hostname }}",
        "name": "{{ hostname }}"
    },
    "log": {
        "level": "{{ err.level }}"
    },
    "message": {{ msg | tojson }},
    "nginx": {
        "error": {}
    },
    "process": {
        "pid": {{ pid }},
        "thread": {
            "id": 0
        }
    }
}