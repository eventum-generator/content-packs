{%- set hostname = params.hostname -%}
{%- set conn_id = shared.get('conn_id', 1000) -%}
{%- set pid = params.get('nginx_pid', 1234) -%}
{%- set tid = pid -%}
{#- Pick an SSL error -#}
{%- set err = samples.error_messages | selectattr("category", "eq", "ssl") | list | random -%}
{%- set src_ip = module.rand.network.ip_v4_public() -%}
{#- SSL errors happen during handshake â€” no request context -#}
{%- set full_message = err.message ~ ", client: " ~ src_ip ~ ", server: 0.0.0.0:443" -%}
{
    "@timestamp": "{{ timestamp.isoformat() }}",
    "agent": {
        "ephemeral_id": "{{ module.rand.crypto.uuid4() }}",
        "id": "{{ params.agent_id }}",
        "name": "{{ hostname }}",
        "type": "filebeat",
        "version": "{{ params.agent_version }}"
    },
    "data_stream": {
        "dataset": "nginx.error",
        "namespace": "default",
        "type": "logs"
    },
    "ecs": {
        "version": "8.11.0"
    },
    "event": {
        "category": ["web"],
        "dataset": "nginx.error",
        "kind": "event",
        "module": "nginx",
        "type": ["error"]
    },
    "host": {
        "hostname": "{{ hostname }}",
        "name": "{{ hostname }}"
    },
    "log": {
        "level": "{{ err.level }}"
    },
    "message": {{ full_message | tojson }},
    "nginx": {
        "error": {
            "connection_id": {{ conn_id }}
        }
    },
    "process": {
        "pid": {{ pid }},
        "thread": {
            "id": {{ tid }}
        }
    }
}
{%- do shared.set('conn_id', (conn_id + 1) % 2147483647) -%}